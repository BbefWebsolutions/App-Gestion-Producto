{% extends 'base/base.html' %} {% load static %} 
{% block titulo %}Crear
Cliente
{% endblock %} 
{% block css %} 
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet" href="{% static 'lib/fontawesome-free-6.3.0-web/css/all.min.css' %}">
<!-- Ionicons -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<!-- Tempusdominus Bootstrap 4 -->
<link rel="stylesheet" href="{% static 'lib/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
<!-- iCheck -->
<link rel="stylesheet" href="{% static 'lib/icheck-bootstrap/icheck-bootstrap.min.css' %}">
<!-- JQVMap -->
<link rel="stylesheet" href="{% static 'lib/jqvmap/jqvmap.min.css' %}">
<!-- Theme style -->
<link rel="stylesheet" href="{% static 'assets/css/adminlte.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
<!-- overlayScrollbars -->
<link rel="stylesheet" href="{% static 'lib/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
<!-- Daterange picker -->
<link rel="stylesheet" href="{% static 'lib/daterangepicker/daterangepicker.css' %}">
<!-- summernote -->
<link rel="stylesheet" href="{% static 'lib/summernote/summernote-bs4.min.css' %}">

<link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/22.2.4/css/dx.light.css">

{% endblock %} 

{% block container %}
<div class="content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>Crear y Ver Pedidos</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="/">Inicio</a></li>
            <li class="breadcrumb-item active">Crear y ver pedido</li>
          </ol>
        </div>
      </div>
    </div><!-- /.container-fluid -->
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Crear Pedido</h3>
            
                        <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <form id="id_formAgregarPedido" method="POST" data-parsley-validate enctype="multipart/form-data">{% csrf_token %}
                            <div class="form-group row">
                              <label for="id_cliente" class="col-sm-2 col-form-label">Cliente <span class="tx-danger">*</span> </label>
                              <div class="col-sm-4">
                                  <select class="custom-select" id="id_cliente" name="cliente" required>
                                      <option value="-1" disabled selected>seleccionar</option>
                                      {% for cliente in clientes %}
                                      <option value="{{ cliente.id }}">{{ cliente.nombres }} {{ cliente.apellidos }}</option>
                                      {% endfor %}
                                  </select>
                              </div>
                              <label for="id_existencia" class="col-sm-2 col-form-label">Productos <span class="tx-danger">*</span> </label>
                              <div class="col-sm-4">
                                  <select class="custom-select" id="id_existencia" name="existencia" required>
                                      <option value="-1" disabled selected>seleccionar</option>
                                      {% for stock in stocks %}
                                      <option value="{{ stock.id }}">{{ stock.producto.nombre }} - {{ stock.cantidad }} - {{stock.almacen.nombre}}</option>
                                      {% endfor %}
                                  </select>
                              </div>
                            </div>
                            <div class="form-group row">
                                <label for="id_cantidad" class="col-sm-2 col-form-label">Cantidad <span class="tx-danger">*</span> </label>
                                <div class="col-sm-10">
                                    <input type="number" class="form-control" id="id_cantidad" name="cantidad" placeholder="10000"required>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- /.card-body -->
                    <div class="card-footer">
                        <button type="button" id="btn_guardar" class="btn btn-primary"><i data-feather="save"></i> Guardar</button>
                    </div>
                    <!-- /.card-footer-->
                </div>            
            </div>
        </div>
            <!-- Default box -->
        <div class="card">
              <div class="card-header">
                <h3 class="card-title">Ver Clientes</h3>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div id="gridContainer"></div>
                <!-- <div class="table-responsive"> -->
                    <!-- <table id="myTable">
                      <thead>
                        <tr>
                          <th>Nombres</th>
                          <th>Apellidos</th>
                          <th>Telefono</th>
                          <th>Direccion</th>
                        </tr>
                      </thead>
                      <tbody id="tbody">
                        {% for cliente in clientes %}
                            <tr>
                                <td>{{cliente.nombres}}</td>
                                <td>{{cliente.apellidos}}</td>
                                <td>{{cliente.telefono}}</td>
                                <td>{{cliente.direccion}}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table> -->
                  <!-- </div> -->
                </div>
              </div>
              <!-- /.card-body -->
            </div>
    <!-- /.card -->
    </div>

  </section>
  <!-- /.card -->
</div>
{% endblock %}

{% block js_script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.2/parsley.min.js" integrity="sha512-eyHL1atYNycXNXZMDndxrDhNAegH2BDWt1TmkXJPoGf1WLlNYt08CSjkqF5lnCRmdm3IrkHid8s2jOUY4NIZVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<!-- <script type="text/javascript" src="https://cdn3.devexpress.com/jslib/22.2.4/js/dx.all.js"></script> -->
{% endblock %}

{% block js %}
<script>
$('#btn_guardar').click(function () {
const form = $('#id_formAgregarPedido')
    if (form.parsley().validate()) {
        $.post("/guardar_editar_pedido", form.serialize(), function (response) {
            // alert(response.accionEjecutada)
            if (response.accionEjecutada) {
              $("#gridContainer").dxDataGrid("instance").refresh();
                // alert(response.accionEjecutada)
                // notify = new PNotify({
                //     title: 'Accion exitosa',
                //     text: 'Se ha registrado el usuario exitosamente',
                //     type: 'success',
                //     styling: 'bootstrap3',
                //     delay: 3000
                // });
            }
        })
    }
})

$(function (){
  $("#gridContainer").dxDataGrid({
            dataSource: "{% url 'listar_pedidos' %}",
            showBorders: true,
            showColumnLines: true,
            showRowLines: true,
            columnAutoWidth: true,
            rowAlternationEnabled: true,
            hoverStateEnabled: true,
            stateStoring: {
                enabled: false,
                type: "sessionStorage",
                storageKey: "storage"
            },
            loadPanel: {
                enabled: true
            },
            searchPanel: {
                visible: true,
                highlightCaseSensitive: true
            },
            paging: {
                pageSize: 10
            },
            pager: {
                showPageSizeSelector: true,
                allowedPageSizes: [10, 25, 50, 250, 500, 1000, 2000],
                showInfo: true
            },
            headerFilter: {
                visible: true,
                allowSearch: true
            },
            columnChooser: {
                enabled: true,
                mode: "select"
            },
            "export": {
                enabled: true,
                fileName: "Usuarios Activos",
                allowExportSelectedData: false
            },
            onContentReady: function(e) {
                var $customButton = $('<div id="customButton">').dxButton({
                icon: 'refresh', 
                hint: "Refrescar",
                onClick: function() {
                    const state = JSON.parse(localStorage.getItem("dataGridState"));
                    $("#gridContainer").dxDataGrid('instance').state(state);
                }
                });
                if (e.element.find('#customButton').length == 0)
                e.element.find('.dx-toolbar-after').prepend($customButton);
            },
            columns: [
                {
                    dataField: "cliente",
                    caption: "Cliente",
                    alignment: "left"
                }, {
                    dataField: "movimiento",
                    caption: "Pedido",
                    alignment: "left"
                },{
                    dataField: "ganancia",
                    caption: "Ganancia",
                    alignment: "left"
                },{
                    type: "buttons",
                    caption: "Acciones",
                    alignment: "left",
                    fixed:true,
                    allowHiding: false,
                    showInColumnChooser: false,
                    buttons: []
                }]
        });
})
</script>
{% endblock %}
